<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Create Session â€“ Zero Glitch</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    background: #0f1115;
    color: #e6e6eb;
    font-family: system-ui, Arial;
  }

  .page {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .card {
    width: 420px;
    background: #161922;
    border: 1px solid #262b3d;
    border-radius: 16px;
    padding: 28px;
  }

  h2 { margin-top: 0; }

  label {
    font-size: 13px;
    color: #9aa0b4;
    display: block;
    margin-top: 14px;
    margin-bottom: 6px;
  }

  input, select {
    width: 100%;
    padding: 10px;
    border-radius: 10px;
    background: #0f1115;
    border: 1px solid #262b3d;
    color: #e6e6eb;
    font-size: 14px;
  }

  button {
    width: 100%;
    margin-top: 22px;
    padding: 10px;
    border-radius: 999px;
    border: none;
    background: #ff3b3b;
    color: #fff;
    font-size: 14px;
    cursor: pointer;
  }

  /* Modal */
  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.6);
    display: none;
    align-items: center;
    justify-content: center;
  }

  .modal-box {
    background: #161922;
    border-radius: 14px;
    padding: 20px;
    width: 320px;
    text-align: center;
    border: 1px solid #262b3d;
  }

  .modal-box p {
    margin: 0 0 14px;
    font-size: 14px;
  }

  .modal-box button {
    background: #3b82f6;
  }
</style>
</head>

<body>

<div class="page">
  <div class="card">
    <h2 id="greeting">Create Stream</h2>

    <label>Session name</label>
    <input id="nameInput" placeholder="e.g. JBA_Final">

    
    <label>Viewer access</label>
    <select id="viewerAccess">
      <option value="public">Public</option>
      <option value="protected">Protected</option>
    </select>

    <button id="createBtn">Create Stream</button>
  </div>
</div>

<!-- ERROR MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <p id="modalText"></p>
    <button onclick="closeModal()">OK</button>
  </div>
</div>

<script>
const nameInput = document.getElementById("nameInput");
const createBtn = document.getElementById("createBtn");
const modal = document.getElementById("modal");
const modalText = document.getElementById("modalText");

function showError(msg) {
  modalText.innerText = msg;
  modal.style.display = "flex";
}

function closeModal() {
  modal.style.display = "none";
  nameInput.focus();
}

/* AUTH */
(async () => {
  const res = await fetch("/me", { credentials: "include" });
  if (!res.ok) location.href = "login.html";
  const user = await res.json();
  document.getElementById("greeting").innerText = `Hello ${user.email}`;
})();

/* CREATE */
createBtn.onclick = async () => {
  const name = nameInput.value.trim();

  if (name.length < 3) {
    showError("Stream name must be at least 3 characters.");
    return;
  }

  const res = await fetch("/api/streams", {
    method: "POST",
    credentials: "include",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name })
  });

  if (!res.ok) {
    const data = await res.json();
    showError(data.message || "Failed to create stream.");
    return;
  }

  location.href = "index.html";
};
</script>

</body>
</html>
